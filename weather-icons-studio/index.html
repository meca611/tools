<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Icons Studio - MECA</title>
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css" />
    <!-- Wind Icons Extension (Required for wind direction) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons-wind.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-25..200" />
    <link href="https://fonts.googleapis.com/css2?family=LINE+Seed+JP:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'kodai-murasaki': '#8C6589', /* メイン：古代紫 */
                        'accent-terracotta': '#D97F63', /* 強調：洗朱 */
                        'bg-soft': '#FDFCFD',
                        'text-dark': '#1A1A1A',
                        'text-gray': '#6B5A6B',
                    },
                    borderRadius: {
                        'custom': '8px',
                    }
                }
            }
        }
    </script>
    <style>
        /* UD基準サイズ設計 */
        html { font-size: 16px; }
        @media (min-width: 768px) {
            html { font-size: 18.66px; }
        }

        body { 
            font-family: 'LINE Seed JP', sans-serif; 
            background-color: #FDFCFD; 
            color: #1A1A1A;
            line-height: 1.6;
        }
        .text-min-12pt { font-size: 0.85rem; }
        .text-heading-16pt { font-size: 1.15rem; font-weight: 800; }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #EBE3EB; border-radius: 3px; }
        
        .icon-card.active { border-color: #D97F63; border-width: 2px; background-color: #FFF4F0; }
        .category-btn.active { background-color: #8C6589; color: white; border-color: #8C6589; }
        
        .marker-accent {
            background: linear-gradient(transparent 70%, rgba(217, 127, 99, 0.25) 0%);
            padding: 0 2px;
            font-weight: 800;
        }

        input[type="range"] { -webkit-appearance: none; background: #F5F1F5; height: 6px; border-radius: 3px; outline: none; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 22px; height: 22px; border-radius: 4px;
            background: #D97F63; cursor: pointer; border: 2px solid #fff; box-shadow: 0 2px 8px rgba(217, 127, 99, 0.2);
        }

        #color-picker { -webkit-appearance: none; border: none; padding: 0; background: none; }
        #color-picker::-webkit-color-swatch { border: 1px solid #EBE3EB; border-radius: 4px; }

        .meca-logo-img {
            filter: invert(47%) sepia(11%) saturate(1475%) hue-rotate(257deg) brightness(92%) contrast(84%);
        }

        .preset-color {
            width: 32px; height: 32px; border-radius: 6px; cursor: pointer; border: 1px solid rgba(0,0,0,0.1);
            transition: transform 0.2s; position: relative;
        }
        .preset-color:hover { transform: scale(1.1); z-index: 10; }
        
        .night-active { background-color: #1a1a2e !important; color: #e2e2e2 !important; }
        .night-active .grid-bg { background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px) !important; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="sticky top-0 bg-white/80 backdrop-blur-xl border-b border-[#EBE3EB] px-4 md:px-12 py-4 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto flex flex-col lg:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-3 group cursor-default w-full lg:w-auto justify-center lg:justify-start">
                <div class="w-10 h-10 bg-kodai-murasaki rounded-lg flex items-center justify-center text-white shadow-md shadow-kodai-murasaki/20 group-hover:rotate-6 transition-transform shrink-0">
                    <span class="material-symbols-outlined !text-2xl notranslate">partly_cloudy_day</span>
                </div>
                <div class="text-center lg:text-left">
                    <h1 class="text-heading-16pt text-kodai-murasaki leading-none text-nowrap">Weather Icons Studio</h1>
                    <p class="text-min-12pt font-bold text-[#A18DA1] uppercase tracking-[0.2em] mt-1 opacity-70 text-[0.6rem] md:text-min-12pt text-nowrap">Design by しんやせっけいしゃ / MECA</p>
                </div>
            </div>

            <div class="flex items-center gap-4 w-full lg:w-auto justify-center lg:justify-end">
                <a href="about.html" class="text-sm md:text-min-12pt font-bold text-kodai-murasaki hover:underline whitespace-nowrap flex items-center gap-1">
                    <span class="material-symbols-outlined !text-lg notranslate">info</span> 当サイトについて
                </a>
                <div class="flex bg-[#F5F1F5] p-1 rounded-lg border border-[#EBE3EB]">
                    <button id="mode-day" class="mode-btn px-4 py-1 text-xs md:text-min-12pt font-bold rounded-md bg-white text-kodai-murasaki shadow-sm whitespace-nowrap transition-all">昼間モード</button>
                    <button id="mode-night" class="mode-btn px-4 py-1 text-xs md:text-min-12pt font-bold rounded-md text-text-gray hover:text-kodai-murasaki whitespace-nowrap transition-all">夜間モード</button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 md:px-12 mt-6 md:mt-8 grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
        
        <!-- Left Column: Browser -->
        <div class="lg:col-span-7 flex flex-col gap-6 order-2 lg:order-1">
            <div class="space-y-4">
                <div class="relative">
                    <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-kodai-murasaki !text-xl notranslate">search</span>
                    <input type="text" id="search-input" placeholder="アイコン名やキーワードで検索..." class="w-full pl-12 pr-4 py-4 bg-white border border-[#EBE3EB] rounded-lg text-min-12pt outline-none focus:border-kodai-murasaki transition-all shadow-sm">
                </div>

                <div id="category-container" class="flex flex-nowrap lg:flex-wrap gap-2 py-3 border-b border-[#F5F1F5] overflow-x-auto no-scrollbar">
                    <button class="category-btn active px-4 py-1.5 rounded-md border border-[#EBE3EB] text-sm md:text-min-12pt font-extrabold shrink-0 transition-all" data-cat="all">全アイコン</button>
                    <button class="category-btn px-4 py-1.5 rounded-md border border-[#EBE3EB] text-sm md:text-min-12pt font-extrabold shrink-0 transition-all" data-cat="jma-1">晴れ系</button>
                    <button class="category-btn px-4 py-1.5 rounded-md border border-[#EBE3EB] text-sm md:text-min-12pt font-extrabold shrink-0 transition-all" data-cat="jma-2">曇り系</button>
                    <button class="category-btn px-4 py-1.5 rounded-md border border-[#EBE3EB] text-sm md:text-min-12pt font-extrabold shrink-0 transition-all" data-cat="jma-3">雨系</button>
                    <button class="category-btn px-4 py-1.5 rounded-md border border-[#EBE3EB] text-sm md:text-min-12pt font-extrabold shrink-0 transition-all" data-cat="jma-4">雪系</button>
                    <button class="category-btn px-4 py-1.5 rounded-md border border-[#EBE3EB] text-sm md:text-min-12pt font-extrabold shrink-0 transition-all" data-cat="moon">月齢</button>
                    <button class="category-btn px-4 py-1.5 rounded-md border border-[#EBE3EB] text-sm md:text-min-12pt font-extrabold shrink-0 transition-all" data-cat="wind">風・方位</button>
                    <button class="category-btn px-4 py-1.5 rounded-md border border-[#EBE3EB] text-sm md:text-min-12pt font-extrabold shrink-0 transition-all" data-cat="misc">気象計器</button>
                </div>
            </div>

            <div id="icon-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-4 h-[50vh] md:h-[65vh] overflow-y-auto pr-2 custom-scrollbar content-start pb-20">
                <!-- JS Injected -->
            </div>
        </div>

        <!-- Right Column: Studio -->
        <div class="lg:col-span-5 flex flex-col gap-6 md:gap-8 pb-8 md:pb-16 lg:sticky lg:top-28 order-1 lg:order-2">
            <div id="preview-canvas" class="aspect-square bg-white rounded-xl border border-[#EBE3EB] flex flex-col items-center justify-center relative overflow-hidden shadow-sm transition-colors duration-500 group">
                <div class="grid-bg absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(#8C6589 1px, transparent 1px); background-size: 32px 32px;"></div>
                <div class="flex flex-col items-center z-10 transition-transform duration-500 group-hover:scale-105">
                    <i id="main-preview-icon" class="wi wi-day-sunny leading-none" style="font-size: 80px;"></i>
                    <div class="mt-6 md:mt-8 px-4 py-2 bg-white/20 backdrop-blur-sm border border-[#EBE3EB] rounded-md text-sm md:text-min-12pt font-bold shadow-inner flex flex-col items-center gap-1">
                        <span id="display-class" class="font-mono text-current">wi-day-sunny</span>
                    </div>
                </div>
            </div>

            <!-- Wind Information Alert (Dynamically shown) -->
            <div id="wind-alert" class="hidden p-4 rounded-lg bg-[#FFF4F0] border border-[#EBE3EB] text-sm md:text-min-12pt">
                <div class="flex items-center gap-2 mb-2 text-accent-terracotta font-extrabold">
                    <span class="material-symbols-outlined !text-lg">info</span>
                    風向アイコンの注意点
                </div>
                <p class="text-text-gray text-xs leading-relaxed">
                    風向を表示するには <code>weather-icons-wind.css</code> が必要です。<br>
                    また、クラス指定は <code>wi wi-wind wi-towards-[方位]</code> となります。<br>
                    <a href="about.html" class="underline font-bold text-kodai-murasaki hover:text-accent-terracotta">ABOUTページで仕様を確認する &rarr;</a>
                </p>
            </div>

            <div class="space-y-6 md:space-y-8 bg-white p-2">
                <div class="space-y-3">
                    <label class="text-sm md:text-min-12pt font-extrabold text-[#6B5A6B] uppercase tracking-widest block">色とプリセット</label>
                    <div class="flex items-center gap-3 mb-4 text-nowrap">
                        <input type="color" id="color-picker" class="w-10 h-10 cursor-pointer" value="#333333">
                        <input type="text" id="color-text" class="flex-1 min-w-0 px-1 border-b border-[#EBE3EB] text-sm md:text-min-12pt font-mono font-bold outline-none focus:border-kodai-murasaki uppercase text-list-black" value="#333333">
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <p class="text-[10px] font-black text-[#A18DA1] uppercase tracking-widest mb-2">基本4系統 (JMA)</p>
                            <div class="flex flex-wrap gap-2">
                                <div class="preset-color" style="background: #333333;" title="デフォルト" onclick="setStudioColor('#333333')"></div>
                                <div class="preset-color" style="background: #D97F63;" title="晴れ系 (洗朱)" onclick="setStudioColor('#D97F63')"></div>
                                <div class="preset-color" style="background: #6B7280;" title="曇り系 (灰色)" onclick="setStudioColor('#6B7280')"></div>
                                <div class="preset-color" style="background: #3B82F6;" title="雨系 (青色)" onclick="setStudioColor('#3B82F6')"></div>
                                <div class="preset-color" style="background: #22D3EE;" title="雪系 (水色)" onclick="setStudioColor('#22D3EE')"></div>
                            </div>
                        </div>

                        <div>
                            <p class="text-[10px] font-black text-[#A18DA1] uppercase tracking-widest mb-2">警報・防災 (UD標準色)</p>
                            <div class="flex flex-wrap gap-2">
                                <div class="preset-color" style="background: #B40068;" title="特別警報" onclick="setStudioColor('#B40068')"></div>
                                <div class="preset-color" style="background: #FF2800;" title="警報" onclick="setStudioColor('#FF2800')"></div>
                                <div class="preset-color" style="background: #F2E700;" title="注意報" onclick="setStudioColor('#F2E700')"></div>
                            </div>
                        </div>

                        <div>
                            <p class="text-[10px] font-black text-[#A18DA1] uppercase tracking-widest mb-2">夜間用 (背景暗色向け)</p>
                            <div class="flex flex-wrap gap-2">
                                <div class="preset-color" style="background: #FFFDE7;" title="快晴 (月明かり)" onclick="setStudioColor('#FFFDE7')"></div>
                                <div class="preset-color" style="background: #E0E7FF;" title="曇り (星空)" onclick="setStudioColor('#E0E7FF')"></div>
                                <div class="preset-color" style="background: #C7D2FE;" title="雨 (静寂)" onclick="setStudioColor('#C7D2FE')"></div>
                                <div class="preset-color" style="background: #ffffff; border: 1px solid #ddd;" title="雪 (ホワイト)" onclick="setStudioColor('#ffffff')"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-sm md:text-min-12pt font-extrabold text-[#6B5A6B] uppercase tracking-widest block">サイズ</label>
                    <div class="flex items-center gap-3">
                        <span id="size-val" class="text-accent-terracotta font-bold w-16 text-center text-sm md:text-min-12pt">80px</span>
                        <input type="range" id="size-range" min="16" max="240" step="1" value="80" class="flex-1">
                    </div>
                </div>

                <div class="space-y-4 pt-6 border-t border-[#F5F1F5]">
                    <div class="flex items-center justify-between">
                        <span class="text-xs md:text-min-12pt font-extrabold text-[#A18DA1] uppercase tracking-[0.2em]">実装コード</span>
                        <button id="copy-btn" class="px-4 py-1.5 text-xs md:text-min-12pt font-bold text-white bg-kodai-murasaki rounded-lg shadow-md active:scale-95 transition-all text-nowrap">コピー</button>
                    </div>
                    <div class="bg-text-dark p-4 md:p-6 rounded-lg border border-[#2D2D2D] overflow-x-auto shadow-xl">
                        <pre id="code-block" class="text-[10px] md:text-min-12pt font-mono text-[#D4C3D4] leading-relaxed whitespace-pre-wrap"></pre>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white/50 border-t border-[#E5E1DA] pt-12 pb-10 px-6">
        <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-8">
            <div class="flex flex-col gap-4 items-center md:items-start text-min-12pt">
                <div class="h-12 overflow-hidden flex items-center justify-center">
                    <img src="mecalogo.png" alt="MECA Logo" class="meca-logo-img h-full w-auto object-contain" onerror="this.parentElement.innerHTML='MECA'">
                </div>
                <div class="space-y-2 flex flex-col items-center md:items-start">
                    <p class="font-bold text-text-dark leading-tight uppercase tracking-widest text-center md:text-left text-nowrap">しんやせっけいしゃ（MECA）</p>
                    <p class="font-bold text-text-gray tracking-widest opacity-80 text-center md:text-left text-nowrap">&copy; 2026 Midnight Express Computational Archives</p>
                    <div class="h-[2px] w-12 bg-kodai-murasaki mt-1 mb-2 mx-auto md:mx-0"></div>
                    <div class="flex flex-col items-center md:items-start gap-1">
                        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" target="_blank" class="opacity-70 hover:opacity-100 transition-opacity">
                            <img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
                        </a>
                        <span class="text-[10px] text-text-gray opacity-70">Licensed under <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" target="_blank" class="underline">CC BY 4.0</a>.</span>
                    </div>
                </div>
            </div>
            <div class="flex gap-8 text-min-12pt font-bold text-text-gray uppercase tracking-widest">
                <a href="index.html" class="hover:text-accent-terracotta transition-colors">HOME</a>
                <a href="about.html" class="text-kodai-murasaki cursor-default underline decoration-accent-terracotta decoration-2">ABOUT</a>
            </div>
        </div>
    </footer>

    <script>
        const UD = { SUNNY: '#D97F63', CLOUDY: '#6B7280', RAIN: '#3B82F6', SNOW: '#22D3EE', WARN: '#FF2800' };

        const JMA_DEF = {
            100:{t:'快晴',i:'wi-day-sunny',n:'wi-night-clear',c:UD.SUNNY}, 101:{t:'晴時々曇',i:'wi-day-cloudy',n:'wi-night-alt-cloudy',c:UD.SUNNY}, 110:{t:'晴後時々曇',i:'wi-day-cloudy',n:'wi-night-alt-cloudy',c:UD.SUNNY}, 111:{t:'晴後曇',i:'wi-day-cloudy',n:'wi-night-alt-cloudy',c:UD.SUNNY}, 112:{t:'晴後一時雨',i:'wi-day-rain',n:'wi-night-alt-rain',c:UD.SUNNY}, 115:{t:'晴後一時雪',i:'wi-day-snow',n:'wi-night-alt-snow',c:UD.SUNNY}, 123:{t:'快晴',i:'wi-day-sunny',n:'wi-night-clear',c:UD.SUNNY}, 124:{t:'晴れ',i:'wi-day-sunny',n:'wi-night-clear',c:UD.SUNNY}, 130:{t:'晴時々曇',i:'wi-day-cloudy',n:'wi-night-alt-cloudy',c:UD.SUNNY}, 131:{t:'晴後時々曇',i:'wi-day-cloudy',n:'wi-night-alt-cloudy',c:UD.SUNNY}, 132:{t:'晴後曇',i:'wi-day-cloudy',n:'wi-night-alt-cloudy',c:UD.SUNNY},
            160:{t:'晴一時雪',i:'wi-day-snow',n:'wi-night-alt-snow',c:UD.SNOW}, 170:{t:'晴一時雨',i:'wi-day-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 181:{t:'晴後雨',i:'wi-day-rain',n:'wi-night-alt-rain',c:UD.RAIN},
            200:{t:'曇',i:'wi-cloudy',n:'wi-night-alt-cloudy',c:UD.CLOUDY}, 201:{t:'曇時々晴',i:'wi-day-cloudy-high',n:'wi-night-alt-cloudy-high',c:UD.CLOUDY}, 202:{t:'曇一時雨',i:'wi-day-showers',n:'wi-night-alt-showers',c:UD.RAIN}, 203:{t:'曇一時雪',i:'wi-day-snow',n:'wi-night-alt-snow',c:UD.SNOW}, 210:{t:'曇後時々晴',i:'wi-day-cloudy-high',n:'wi-night-alt-cloudy-high',c:UD.CLOUDY}, 211:{t:'曇後晴',i:'wi-day-cloudy-high',n:'wi-night-alt-cloudy-high',c:UD.CLOUDY}, 212:{t:'曇後一時雨',i:'wi-day-showers',n:'wi-night-alt-showers',c:UD.RAIN}, 213:{t:'曇後一時雪',i:'wi-day-snow',n:'wi-night-alt-snow',c:UD.SNOW},
            220:{t:'曇後時々雨',i:'wi-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 221:{t:'曇後雨',i:'wi-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 222:{t:'曇後雪',i:'wi-snow',n:'wi-night-alt-snow',c:UD.SNOW}, 223:{t:'曇後時々雪',i:'wi-snow',n:'wi-night-alt-snow',c:UD.SNOW}, 224:{t:'曇後雷雨',i:'wi-storm-showers',n:'wi-night-alt-storm-showers',c:UD.WARN}, 225:{t:'曇後雷',i:'wi-lightning',n:'wi-night-alt-lightning',c:UD.WARN}, 228:{t:'曇後雷',i:'wi-lightning',n:'wi-night-alt-lightning',c:UD.WARN}, 229:{t:'曇後雷雨',i:'wi-storm-showers',n:'wi-night-alt-storm-showers',c:UD.WARN},
            230:{t:'曇時々晴',i:'wi-day-cloudy-high',n:'wi-night-alt-cloudy-high',c:UD.CLOUDY}, 231:{t:'曇後時々晴',i:'wi-day-cloudy-high',n:'wi-night-alt-cloudy-high',c:UD.CLOUDY}, 240:{t:'曇一時雨',i:'wi-day-showers',n:'wi-night-alt-showers',c:UD.RAIN}, 250:{t:'曇一時雪',i:'wi-day-snow',n:'wi-night-alt-snow',c:UD.SNOW}, 260:{t:'曇一時雪',i:'wi-day-snow',n:'wi-night-alt-snow',c:UD.SNOW}, 270:{t:'曇一時雨',i:'wi-day-showers',n:'wi-night-alt-showers',c:UD.RAIN}, 281:{t:'曇後雨',i:'wi-rain',n:'wi-night-alt-rain',c:UD.RAIN},
            300:{t:'雨',i:'wi-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 301:{t:'雨時々晴',i:'wi-day-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 302:{t:'雨時々止む',i:'wi-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 303:{t:'雨時々雪',i:'wi-rain-mix',n:'wi-night-alt-rain-mix',c:UD.RAIN}, 304:{t:'雨又は雪',i:'wi-rain-mix',n:'wi-night-alt-rain-mix',c:UD.RAIN}, 306:{t:'大雨',i:'wi-thunderstorm',n:'wi-night-alt-thunderstorm',c:UD.WARN}, 308:{t:'暴風雨',i:'wi-rain-wind',n:'wi-night-alt-rain-wind',c:UD.WARN}, 309:{t:'雨一時雪',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW},
            311:{t:'雨後晴',i:'wi-day-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 313:{t:'雨後曇',i:'wi-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 314:{t:'雨後雪',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 315:{t:'雨後一時雪',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 316:{t:'雨後雷',i:'wi-lightning',n:'wi-night-alt-lightning',c:UD.WARN}, 317:{t:'雨後晴',i:'wi-day-rain',c:UD.RAIN}, 320:{t:'朝の内雨後晴',i:'wi-day-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 321:{t:'朝の内雨後曇',i:'wi-rain',n:'wi-night-alt-rain',c:UD.RAIN}, 322:{t:'雨後時々雪',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 323:{t:'雨後雪',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 324:{t:'雨後暴風',i:'wi-rain-wind',n:'wi-night-alt-rain-wind',c:UD.WARN}, 325:{t:'雨後暴風雪',i:'wi-snow-wind',n:'wi-night-alt-snow-wind',c:UD.WARN}, 326:{t:'雨後大雪',i:'wi-snow',c:UD.SNOW}, 327:{t:'雨後みぞれ',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 328:{t:'雨後一時みぞれ',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 329:{t:'雨後曇',i:'wi-rain',c:UD.RAIN},
            340:{t:'雪又は雨',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 350:{t:'雨一時雪',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 361:{t:'雪一時雨',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}, 371:{t:'雪後雨',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.RAIN},
            400:{t:'雪',i:'wi-snow',c:UD.SNOW}, 401:{t:'雪時々晴',i:'wi-day-snow',c:UD.SNOW}, 402:{t:'雪時々止む',i:'wi-snow',c:UD.SNOW}, 403:{t:'雪時々雨',i:'wi-sleet',c:UD.SNOW}, 405:{t:'大雪',i:'wi-snow-wind',n:'wi-night-alt-snow-wind',c:UD.SNOW}, 406:{t:'風雪強い',i:'wi-snow-wind',n:'wi-night-alt-snow-wind',c:UD.WARN}, 407:{t:'暴風雪',i:'wi-snow-wind',n:'wi-night-alt-snow-wind',c:UD.WARN}, 409:{t:'雪で暴風',i:'wi-snow-wind',n:'wi-night-alt-snow-wind',c:UD.WARN},
            411:{t:'雪後晴',i:'wi-day-snow',c:UD.SNOW}, 413:{t:'雪後曇',i:'wi-snow',c:UD.SNOW}, 414:{t:'雪後雨',i:'wi-sleet',c:UD.RAIN}, 420:{t:'朝の内雪後晴',i:'wi-day-snow',c:UD.SNOW}, 421:{t:'朝の内雪後曇',i:'wi-snow',c:UD.SNOW}, 422:{t:'雪後時々雨',i:'wi-sleet',c:UD.RAIN}, 423:{t:'雪後雨',i:'wi-sleet',c:UD.RAIN}, 425:{t:'雪後暴風',i:'wi-snow-wind',c:UD.WARN}, 426:{t:'雪後暴風雪',i:'wi-snow-wind',c:UD.WARN}, 427:{t:'雪後大雪',i:'wi-snow',c:UD.SNOW}, 450:{t:'雪一時雨',i:'wi-sleet',n:'wi-night-alt-sleet',c:UD.SNOW}
        };

        const MOON_PHASES = ['new','waxing-crescent-1','waxing-crescent-2','waxing-crescent-3','waxing-crescent-4','waxing-crescent-5','waxing-crescent-6','first-quarter','waxing-gibbous-1','waxing-gibbous-2','waxing-gibbous-3','waxing-gibbous-4','waxing-gibbous-5','waxing-gibbous-6','full','waning-gibbous-1','waning-gibbous-2','waning-gibbous-3','waning-gibbous-4','waning-gibbous-5','waning-gibbous-6','third-quarter','waning-crescent-1','waning-crescent-2','waning-crescent-3','waning-crescent-4','waning-crescent-5','waning-crescent-6'];
        const MOON_DATA = MOON_PHASES.map((phase, i) => ({ id: `moon-${i}`, name: `月齢 ${i}`, icon: `wi-moon-alt-${phase}`, cat: "moon" }));

        // Corrected WIND_DATA with 16 Cardinal Directions
        const WIND_DATA = [
            { id: "wi-towards-n", name: "北風 (N)", icon: "wi-wind wi-towards-n", cat: "wind" },
            { id: "wi-towards-nne", name: "北北東 (NNE)", icon: "wi-wind wi-towards-nne", cat: "wind" },
            { id: "wi-towards-ne", name: "北東 (NE)", icon: "wi-wind wi-towards-ne", cat: "wind" },
            { id: "wi-towards-ene", name: "東北東 (ENE)", icon: "wi-wind wi-towards-ene", cat: "wind" },
            { id: "wi-towards-e", name: "東風 (E)", icon: "wi-wind wi-towards-e", cat: "wind" },
            { id: "wi-towards-ese", name: "東南東 (ESE)", icon: "wi-wind wi-towards-ese", cat: "wind" },
            { id: "wi-towards-se", name: "南東 (SE)", icon: "wi-wind wi-towards-se", cat: "wind" },
            { id: "wi-towards-sse", name: "南南東 (SSE)", icon: "wi-wind wi-towards-sse", cat: "wind" },
            { id: "wi-towards-s", name: "南風 (S)", icon: "wi-wind wi-towards-s", cat: "wind" },
            { id: "wi-towards-ssw", name: "南南西 (SSW)", icon: "wi-wind wi-towards-ssw", cat: "wind" },
            { id: "wi-towards-sw", name: "南西 (SW)", icon: "wi-wind wi-towards-sw", cat: "wind" },
            { id: "wi-towards-wsw", name: "西南西 (WSW)", icon: "wi-wind wi-towards-wsw", cat: "wind" },
            { id: "wi-towards-w", name: "西風 (W)", icon: "wi-wind wi-towards-w", cat: "wind" },
            { id: "wi-towards-wnw", name: "西北西 (WNW)", icon: "wi-wind wi-towards-wnw", cat: "wind" },
            { id: "wi-towards-nw", name: "北西 (NW)", icon: "wi-wind wi-towards-nw", cat: "wind" },
            { id: "wi-towards-nnw", name: "北北西 (NNW)", icon: "wi-wind wi-towards-nnw", cat: "wind" },
            { id: "wi-strong-wind", name: "強風", icon: "wi-strong-wind", cat: "wind" },
            { id: "wi-windy", name: "暴風", icon: "wi-windy", cat: "wind" },
            { id: "wi-tornado", name: "竜巻", icon: "wi-tornado", cat: "wind" }
        ];

        const MISC_DATA = ["thermometer", "barometer", "humidity", "sunrise", "sunset", "umbrella", "stars", "lightning", "fog", "hail", "alien", "meteor", "dust", "smoke"].map(m => ({ id: `wi-${m}`, name: m, icon: `wi-${m}`, cat: "misc" }));

        // --- 5. 状態管理とレンダリングロジック ---
        let isNight = false, activeCategory = "all", searchTerm = "", selectedIconId = "100", selectedIconClass = "wi-day-sunny", selectedCategory = "jma", currentColor = "#333333", currentSize = 80;

        const grid = document.getElementById('icon-grid'), previewIcon = document.getElementById('main-preview-icon'), previewCanvas = document.getElementById('preview-canvas'), colorPicker = document.getElementById('color-picker'), colorText = document.getElementById('color-text'), sizeRange = document.getElementById('size-range'), codeBlock = document.getElementById('code-block'), sizeVal = document.getElementById('size-val'), categoryBtns = document.querySelectorAll('.category-btn');
        const windAlert = document.getElementById('wind-alert');

        function renderGrid() {
            let items = [];
            
            // JMA_DEFをフラットな配列に変換
            const jmaMapped = Object.entries(JMA_DEF).map(([code, d]) => ({
                id: code,
                name: d.t,
                icon: isNight ? (d.n || d.i) : d.i,
                cat: d.c === UD.SUNNY ? 'UD.SUNNY' : d.c === UD.CLOUDY ? 'UD.CLOUDY' : d.c === UD.RAIN ? 'UD.RAIN' : d.c === UD.SNOW ? 'UD.SNOW' : d.c === UD.WARN ? 'UD.WARN' : 'misc'
            }));

            if (activeCategory === "all") {
                items = items.concat(jmaMapped, MOON_DATA, WIND_DATA, MISC_DATA);
            } else {
                if (activeCategory.startsWith('UD.')) {
                    items = jmaMapped.filter(d => d.cat === activeCategory);
                } else if (activeCategory === "moon") {
                    items = MOON_DATA;
                } else if (activeCategory === "wind") {
                    items = WIND_DATA;
                } else if (activeCategory === "misc") {
                    items = MISC_DATA;
                }
            }

            // 検索フィルタリング
            if (searchTerm) {
                const term = searchTerm.toLowerCase().trim();
                items = items.filter(i => 
                    i.name.toLowerCase().includes(term) || 
                    (typeof i.icon === 'string' && i.icon.toLowerCase().includes(term)) || 
                    i.id.toString().includes(term)
                );
            }

            grid.innerHTML = items.map(item => {
                const isActive = (item.id.toString() === selectedIconId.toString());
                return `
                    <div onclick="selectIcon('${item.id}', '${item.icon}', '${item.cat}')" 
                         class="icon-card flex flex-col items-center justify-between p-4 rounded-lg border bg-white transition-all cursor-pointer ${isActive ? 'active shadow-md' : 'border-[#F5F1F5] hover:border-[#EBE3EB] text-[#6B5A6B]'}" 
                         role="button">
                        <div class="flex-1 flex items-center justify-center p-2">
                            <i class="wi ${item.icon} text-3xl" style="color: ${isActive ? currentColor : 'inherit'}"></i>
                        </div>
                        <div class="mt-2 text-center w-full overflow-hidden">
                            <div class="text-[9px] font-mono opacity-50 truncate">${item.id}</div>
                            <div class="text-[11px] font-bold truncate">${item.name}</div>
                        </div>
                    </div>`;
            }).join('');
        }

        function selectIcon(id, iconClass, category) {
            selectedIconId = id;
            selectedIconClass = iconClass;
            selectedCategory = category;
            updatePreview();
            renderGrid();
        }
        
        function updatePreview() {
            // 風向アイコンの場合はクラス構造が異なるためそのまま適用、それ以外は `wi` を付与
            const className = (selectedCategory === 'wind' && selectedIconClass.includes('wi-wind')) 
                ? selectedIconClass 
                : `wi ${selectedIconClass}`;
            
            previewIcon.className = `${className} leading-none`;
            previewIcon.style.fontSize = `${currentSize}px`;
            previewIcon.style.color = currentColor;
            document.getElementById('display-class').textContent = selectedIconClass;
            sizeVal.textContent = `${currentSize}px`;

            // 風向アラートの表示制御
            if (selectedCategory === 'wind' || selectedIconClass.includes('wind')) {
                windAlert.classList.remove('hidden');
            } else {
                windAlert.classList.add('hidden');
            }

            if (isNight) { previewCanvas.classList.add('night-active'); } else { previewCanvas.classList.remove('night-active'); }
            
            codeBlock.textContent = `<i class="${className}" style="color: ${currentColor}; font-size: ${currentSize}px;"></i>`;
        }

        function setStudioColor(hex) {
            currentColor = hex;
            colorPicker.value = hex;
            colorText.value = hex.toUpperCase();
            updatePreview();
            renderGrid();
        }
        window.setStudioColor = setStudioColor;

        // モード切り替えロジック
        document.getElementById('mode-day').addEventListener('click', function() {
            isNight = false;
            this.className = "mode-btn px-4 py-1 text-xs md:text-min-12pt font-bold rounded-md bg-white text-kodai-murasaki shadow-sm whitespace-nowrap transition-all";
            document.getElementById('mode-night').className = "mode-btn px-4 py-1 text-xs md:text-min-12pt font-bold rounded-md text-text-gray hover:text-kodai-murasaki whitespace-nowrap transition-all";
            if (currentColor === '#FFFDE7' || currentColor === '#ffffff' || currentColor === '#E0E7FF' || currentColor === '#C7D2FE') setStudioColor('#333333');
            
            // JMAアイコンのみ再同期
            const entry = JMA_DEF[selectedIconId];
            if (entry) selectedIconClass = entry.i;
            
            renderGrid(); updatePreview();
        });

        document.getElementById('mode-night').addEventListener('click', function() {
            isNight = true;
            this.className = "mode-btn px-4 py-1 text-xs md:text-min-12pt font-bold rounded-md bg-white text-kodai-murasaki shadow-sm whitespace-nowrap";
            document.getElementById('mode-day').className = "mode-btn px-4 py-1 text-xs md:text-min-12pt font-bold rounded-md text-text-gray hover:text-kodai-murasaki whitespace-nowrap";
            if (currentColor === '#333333' || currentColor === '#000000') setStudioColor('#FFFDE7');
            
            // JMAアイコンのみ再同期
            const entry = JMA_DEF[selectedIconId];
            if (entry) selectedIconClass = entry.n || entry.i;
            
            renderGrid(); updatePreview();
        });

        categoryBtns.forEach(btn => btn.addEventListener('click', function() {
            categoryBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            activeCategory = this.dataset.cat;
            renderGrid();
        }));

        document.getElementById('search-input').addEventListener('input', (e) => { searchTerm = e.target.value; renderGrid(); });
        colorPicker.addEventListener('input', (e) => { currentColor = e.target.value; colorText.value = currentColor.toUpperCase(); updatePreview(); renderGrid(); });
        colorText.addEventListener('input', (e) => { currentColor = e.target.value; colorPicker.value = currentColor; updatePreview(); renderGrid(); });
        sizeRange.addEventListener('input', (e) => { currentSize = e.target.value; updatePreview(); });
        
        document.getElementById('copy-btn').addEventListener('click', function() {
            const el = document.createElement('textarea'); el.value = codeBlock.textContent; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
            const ot = this.textContent; this.textContent = '完了！'; setTimeout(() => { this.textContent = ot; }, 2000);
        });
        
        // 初期実行
        renderGrid();
        updatePreview();
    </script>
</body>
</html>